<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal Budget</title>
    <!-- SEO- Updated relevant description and keywords for best practices  -->
    <meta name="description" content="Personal Financial budget Application" />
    <meta name="keywords" content="Personal, budget, financial planning, " />
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="main.css" />
  </head>

  <body>
    <header class="page-header">
      <a href="#main" class="skip">Skip to content</a>

      <!--Semantic HTML TAG :Added NAV tag as part of semantic html tag -->
      <nav aria-label="navigation">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/about.html">About</a></li>
          <li><a href="/login.html">Login</a></li>
          <li><a href="https://google.com">Google</a></li>
        </ul>
      </nav>
      <!-- Adding Tab index to bring the for screen reader visibility  -->

      <div class="hero" tabindex="0">
        <h1>Personal Budget</h1>
        <h2>A personal-budget management app</h2>
      </div>
    </header>

    <!-- Changed all the non title h1 tags to h3 tags as per SEO best practices   -->
    <main class="center" id="main">
      <!--Semantic HTML TAG Added Section tag as part of semantic html tag -->
      <!-- A11y- Accessibility, Added aria-label and tabindex for Accessability tab navigation -->
      <section class="banner" aria-label="banner" tabindex="0">
        <!-- A11y- Accessibility, Added tabindex for Accessability tab navigation -->
        <article tabindex="0">
          <h3>Stay on track</h3>
          <p>
            Do you know where you are spending your money? If you really stop to
            track it down, you would get surprised! Proper budget management
            depends on real data... and this app will help you with that!
          </p>
        </article>
        <!-- A11y- Accessibility, Added tabindex for Accessability tab navigation -->

        <article tabindex="0">
          <h3>Alerts</h3>
          <p>
            What if your clothing budget ended? You will get an alert. The goal
            is to never go over the budget.
          </p>
        </article>
        <!-- A11y- Accessibility, Added tabindex for Accessability tab navigation -->

        <article tabindex="0">
          <h3>Results</h3>
          <p>
            People who stick to a financial plan, budgeting every expense, get
            out of debt faster! Also, they to live happier lives... since they
            expend without guilt or fear... because they know it is all good and
            accounted for.
          </p>
        </article>
        <!-- A11y- Accessibility, Added tabindex for Accessability tab navigation -->
        <article tabindex="0">
          <h3>Free</h3>
          <p>This app is free!!! And you are the only one holding your data!</p>
        </article>
        <!-- A11y- Accessibility, Added tabindex for Accessability tab navigation -->
        <article tabindex="0">
          <h3>Stay on track</h3>
          <p>
            Do you know where you are spending your money? If you really stop to
            track it down, you would get surprised! Proper budget management
            depends on real data... and this app will help you with that!
          </p>
        </article>
      </section>

      <!--Semantic HTML TAG Added Section tag as part of semantic html tag -->
      <!-- A11y- Accessibility, Added tabindex for Accessability tab navigation -->
      <div tabindex="0" aria-label="Budget donut charts" class="charts banner">
    
            <div class="switches-container">
              <input type="radio" id="switchMonthly" name="switchPlan" value="D3.js Chat" checked="checked" onclick="toggleChart(value)" />
              <input type="radio" id="switchYearly" name="switchPlan" value="Chart.js" onclick="toggleChart(value)"/>
              <label for="switchMonthly">D3.js Chat</label>
              <label for="switchYearly">Chart.js </label>
              <div class="switch-wrapper">
                <div class="switch">
                  <div>D3.js Chat</div>
                  <div>Chart.js</div>
                </div>
              </div>
            </div>
         <!--    </se> -->
          <article tabindex="0" class="chart-js inactive-state  chart-bg">
            <!-- <h3>Expense Chart JS</h3> -->
            <p>
              <canvas id="myPieChart" width="400" height="400"></canvas>
            </p>
        </article>
  
          <!-- A11y- Accessibility, Added tabindex for Accessability tab navigation -->
  
          <article tabindex="0" class="d3-js active-state chart-bg">
            <!-- <h3>Expense D3 Chart</h3>
   -->
            <div id="chart"></div>
          </article>
        

       
        </div>
    </main>

    <footer class="bottom">
      <div class="center">
        All rights reserved &copy; Prakasam Venkatachalam
      </div>
    </footer>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.min.js"
      integrity="sha512-quHCp3WbBNkwLfYUMd+KwBAgpVukJu5MncuQaWXgCrfgcxCJAq/fo+oqrRKOj+UKEmyMCG3tb8RB63W+EmrOBg=="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"
      integrity="sha512-s+xg36jbIujB2S2VKfpGmlC3T5V2TF3lY48DX7u2r9XzGzgPsa6wTpOQA7J9iffvdeBN0q9tKzRxVxw1JviZPg=="
      crossorigin="anonymous"
    ></script>

    <!-- Load d3.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <script>
      var dataSource = {
        datasets: [
          {
            data: [],
            backgroundColor: [
              "#ffcd56",
              "#ff6384",
              "#36a2eb",
              "#fd6b19",
              "#fc6d19",
              "#ff6c20",
              "#dfd619",
              "#e6a2ec",
            ],
            hoveroffset: 4,
          },
        ],
        labels: [],
      };

      /**
       * Creates Donut Pie chart using chart.js and renders it to the page
       */
      function createChart() {
        var ctx = document.getElementById("myPieChart").getContext("2d");
        var myPieChart = new Chart(ctx, {
          type: "doughnut",
          data: dataSource,
        });
      }

      /**
       * API call to my droplet container
       * Fetches budget data from the backend API and calls createChart() to render it to the page
       */
      function getBudget() {
        // axios.get('http://137.184.110.255:3000/budget')
       // axios.get("http://167.71.175.64:3001/budget").then(function (res) {
        axios.get("http://localhost:3000/budget").then(function (res) {
          for ( var j=0; j < res.data.length; j++ ) {
            for (var i = 0; i < res.data[j].myBudget.length; i++) {
            dataSource.datasets[0].data[i] = res.data[j].myBudget[i].budget;
            dataSource.datasets[0].backgroundColor[i] = res.data[j].myBudget[i].color;
            dataSource.labels[i] = res.data[j].myBudget[i].title;
          }
          }
          
          createChart();
          createD3Chart(res.data[0].myBudget);
        });
      }

      /**
       * Creates Donut Pie chart using d3.js and renders it to the page
       */
      function createD3Chart(myBudget) {
        var data = myBudget;
        console.log(data);

        var height = 400;
        var width = 400;
        var totalRadius = Math.min(width, height) / 2;
        var donutHoleRadius = totalRadius * 0.5;
        var color = d3.scale.category10();

        var svg = d3
          .select("#chart")
          .append("svg")
          .attr("width", width)
          .attr("height", height)
          .append("g")
          .attr("transform", `translate(${width / 2}, ${height / 2})`);

        var arc = d3.svg
          .arc()
          .innerRadius(totalRadius - donutHoleRadius)
          .outerRadius(totalRadius);

        var pie = d3.layout
          .pie()
          .value((d) => d.budget)
          .sort(null);

        var path = svg
          .selectAll("path")
          .data(pie(data))
          .enter()
          .append("path")
          .attr("d", arc)
          .attr("fill", (d, i) => color(d.data.title));

        var legendItemSize = 18;
        var legendSpacing = 4;

        var legend = svg
          .selectAll(".legend")
          .data(color.domain())
          .enter()
          .append("g")
          .attr("class", "legend")
          .attr("transform", (d, i) => {
            var height = legendItemSize + legendSpacing;
            var offset = (height * color.domain().length) / 2;
            var x = legendItemSize * -1;
            var y = i * height - offset;
            return `translate(${x}, ${y})`;
          });

        legend
          .append("rect")
          .attr("width", legendItemSize)
          .attr("height", legendItemSize)
          .style("fill", color);

        legend
          .append("text")
          .attr("x", legendItemSize + legendSpacing)
          .attr("y", legendItemSize - legendSpacing)
          .text((d) => d);
      }

      getBudget();

     


      toggleChart = (value) => {
        if (value === "D3.js Chat") {
          document.querySelector(".chart-js").style.display = "none";
          document.querySelector(".d3-js").style.display = "block";
        } else {
          document.querySelector(".chart-js").style.display = "block";
          document.querySelector(".d3-js").style.display = "none";
        }
      };
    </script>
  </body>
</html>
